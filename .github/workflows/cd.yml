name: CD Pipeline

on:
  workflow_run:
    workflows: ["CI Pipeline"]
    types: 
      - completed

jobs:
  build:
    runs-on: self-hosted
    steps:
      - name: Pull Server Image
        run: docker pull ianwu1992/cmpt_276_project_group_20-server:latest

      - name: Pull Client Image
        run: docker pull ianwu1992/cmpt_276_project_group_20-client:latest

      - name: Delete Old Server Container
        run: docker rm -f cmpt_276_project_group_20-server 2>$null

      - name: Delete Old Client Container
        run: docker rm -f cmpt_276_project_group_20-client 2>$null

      - name: Run New Server Container
        run: docker run -d -p 8000:8000 --name cmpt_276_project_group_20-server ianwu1992/cmpt_276_project_group_20-server:latest

      - name: Run New Client Container
        # Update the port if the client uses a different port
        run: docker run -d -p 5173:80 --name cmpt_276_project_group_20-client ianwu1992/cmpt_276_project_group_20-client:latest
